name : TerraformPlan
trigger : none

pool : 
  vmImage: 'ubuntu-latest'

steps:
- task: TerraformInstaller@1
  displayName: TerraformInstall
  inputs:
    terraformVersion: 'latest'
- task: TerraformTask@5
  displayName: TerraformInit
  inputs:
    provider: 'azurerm'
    command: 'init'
    workingDirectory: '$(System.DefaultWorkingDirectory)/todoapp-infra'
    backendServiceArm: 'SVC-Ketan'
    backendAzureRmOverrideSubscriptionID: '8c7f87da-a447-4222-8e07-a8253eaea14b'
    backendAzureRmResourceGroupName: 'ketan-rg'
    backendAzureRmStorageAccountName: 'strgtfstateketan'
    backendAzureRmContainerName: 'tfstateketan'
    backendAzureRmKey: 'ketandevops.terraform.tfstate'

- task: TerraformTask@5
  displayName: TerraformPlan
  inputs:
    provider: 'azurerm'
    command: 'plan'
    workingDirectory: '$(System.DefaultWorkingDirectory)/todoapp-infra'
    commandOptions: '-var-file=config.tst.tfvars'
    environmentServiceNameAzureRM: 'SVC-Ketan'